---
title: "Sesión 2 - Preprocesamiento"
author: "CR"
date: "18 de septiembre de 2020"
output: html_document
---

Trabajaremos con la [página de la CIA](https://www.cia.gov/library/publications/resources/the-world-factbook/docs/rankorderguide.html) en la cual figuran varias tablas de países con distintos indicadores. 

## Ejercicio 1: PBI

Bajar la información de [este link](https://www.cia.gov/library/publications/resources/the-world-factbook/fields/211rank.html)

Bajamos la data:

```{r}
library(htmltab)
web1 = "https://www.cia.gov/library/publications/resources/the-world-factbook/fields/211rank.html"
path1 = '//*[@id="rankOrder"]'
data1 = htmltab(doc = web1, which =path1)
```

Vemos que la variable de nuestro interés está "sucia" pues tiene el símbolo "$" y ",".

Entonces le decimos al programa que reemplace ambos caractéres por "" (nada):

```{r}
library(stringr)
names(data1)
data1$var1 = data1$'GDP - per capita (PPP)'
data1[1,5]
data1$var1 = gsub(',',"",data1$var1) 
data1$var1 = gsub('$',"",data1$var1) 
head(data1)
```


## Ejercicio 2

[Link](https://www.cia.gov/library/publications/resources/the-world-factbook/fields/239rank.html)

```{r}
library(htmltab)
web2 = "https://www.cia.gov/library/publications/resources/the-world-factbook/fields/239rank.html"
path2 = '//*[@id="rankOrder"]'
data2 = htmltab(doc = web2, which =path2)
head(data2)
```

Vemos que la variable de nuestro interés está "sucia" pues tiene el símbolo "$" y ",".

Entonces le decimos al programa que reemplace ambos caractéres por "" (nada):

```{r}
names(data2)
data2$var1 = data2$Exports
data2[1,5] #Con esto podemos ver el primer elemento de ese vector para darle una revisión
data2$var1 = gsub(',',"",data2$var1) 
# aquí me falta un comando para sacar EL DOLAR IGUAL QUE EL EJERCICIO 2!!
head(data2$var1)
```

Luego lo convertimos a numérico y cambiamos de escala (en millones)



## Ejercicio 3

En el siguiente link tenemos una [tabla sobre emisiones de dióxido de carbono](https://www.cia.gov/library/publications/resources/the-world-factbook/fields/274.html)

Obtenemos la base de datos utilizando el *scrapping web*:

```{r}
library(htmltab)
web3 = "https://www.cia.gov/library/publications/resources/the-world-factbook/fields/274.html"
path3 = '//*[@id="fieldListing"]'
data3 = htmltab(doc = web3, which =path3)
```


Ahora vemos rápidamente la base obtenida para ver si está "limpia o sucia":

```{r}
head(data3)
```

Vemos más de cerca el primer elemento del segundo vector (segunda columna):


```{r}
data3[1,2]
```

Identificamos el patrón: hay algunos números (también expresados con palabras) que luego son seguidos por Mt (año est.)

Creamos la var1 que será nuestra variables base.
Eliminamos la anterior. 
Creamos la variable 2, la cual será la primera parte de esta variable, dividida por el término "Mt".

```{r}
names(data3)
data3$var1 = data3$`Carbon dioxide emissions from consumption of energy`
data3$`Carbon dioxide emissions from consumption of energy`=NULL
data3$var2=str_split(string = data3$var1,
                         pattern = 'Mt',
                        simplify = T)[,1]
```

Vemos los primeros elemento de este nuevo vector:

```{r}
head(data3)[,3]
```

Una vez que hemos dividido la celda nos damos cuenta que algunas están en miles, otras en millones (con la palabra "million") y otras en billones (con la palabra "billion"). Esto es un problema

Por ello, debemos **reemplazar** estas palabras (million, billion) por números para poder convertir estas variables en **numéricas**. 

Entonces, nuevamente dividimos esa variable (var2) y el caracter de separación será el " ". 

Crearemos el vector "número" que será el número base y el "mult" que será el multiplicador. 

```{r}
data3$numero=str_split(string = data3$var2,
                         pattern = ' ',
                         simplify = T)[,1]
data3$mult=str_split(string = data3$var2,
                         pattern = ' ',
                         simplify = T)[,2]
```

Una vez que creamos dichos vectores los visualizamos.

```{r}
head(data3$numero)
head(data3$mult)
```

Ahora veamos la columna "mult" y comencemos a reemplazar.

La palabra "million" por 1000000:

```{r}
data3$mult = gsub('million',"1000000",data3$mult) # reemplaza la palabra million por el número correspondiente.
```

La palabra "billion" por 1000000000:

```{r}
data3$mult = gsub('billion',"1000000000",data3$mult) # reemplaza la palabra billion por el número correspondiente.
```

Los espacios vacíos por 1 (para que el resultado sea el mismo). 

```{r}
data3$mult[data3$mult == ""] <- "1" # reemplaza los espacios vacíos por el número 1.
```

Ahora en el vector del número base hay que reemplazar las "," por "":

```{r}
data3$numero = gsub(',',"",data3$numero) # lo reemplaza por nada ''.
```

Ahora volvemos los dos vectores en numéricos:

```{r}
data3$numero = as.numeric(data3$numero)
data3$mult = as.numeric(data3$mult)
```

Finalmente calculamos una nueva variable que sea la multiplicación entre el número base y el multiplicador (1, millón o billón)

```{r}
data3$final = (data3$numero*data3$mult)
data3$final = (data3$final/1000000000)
```

Finalmente ya tenemos nuestra variable expresada en billones. 

```{r}
head(data3$final)
```




